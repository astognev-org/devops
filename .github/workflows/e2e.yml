name: E2E tests

on:
  workflow_call:
    inputs:
      verify_enabled:
        type: boolean
        required: true
      base_ref:
        type: string
        required: true
      head_sha:
        type: string
        required: true
      pr_number:
        type: number
        required: true

permissions:
  contents: write
  pull-requests: read

jobs:
  verify:
    name: Verify (E2E)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v7
        with:
          script: |
            core.notice('verify_enabled input: ${{ inputs.verify_enabled }}');
      
      - name: Skip when label missing
        if: ${{ !inputs.verify_enabled }}
        run: echo 'skip'

      - uses: actions/checkout@v4
        if: ${{ inputs.verify_enabled }}

      - uses: actions/setup-node@v4
        if: ${{ inputs.verify_enabled }}
        with:
          node-version: "20"
          cache: "npm"

      - run: npm ci
        if: ${{ inputs.verify_enabled }}

      - run: node -e "console.log('E2E OK')"
        if: ${{ inputs.verify_enabled }}
